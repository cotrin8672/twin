# twin.toml.example - Twinè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚µãƒ³ãƒ—ãƒ«
# ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ twin.toml ã¨ã—ã¦ã‚³ãƒ”ãƒ¼ã—ã¦ä½¿ç”¨ã—ã¦ãã ã•ã„

# ====================
# åŸºæœ¬è¨­å®š
# ====================

# ãƒ¯ãƒ¼ã‚¯ãƒ„ãƒªãƒ¼ã‚’ä½œæˆã™ã‚‹ãƒ™ãƒ¼ã‚¹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: "./worktrees"
# ç›¸å¯¾ãƒ‘ã‚¹ã¾ãŸã¯çµ¶å¯¾ãƒ‘ã‚¹ã‚’æŒ‡å®šå¯èƒ½
worktree_base = "./worktrees"

# Gitãƒ–ãƒ©ãƒ³ãƒåã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹
# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: "agent/"
# ä¾‹: agent-001 â†’ agent/agent-001 ãƒ–ãƒ©ãƒ³ãƒãŒä½œæˆã•ã‚Œã‚‹
branch_prefix = "agent/"

# ====================
# ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒãƒ”ãƒ³ã‚°è¨­å®š
# ====================
# å„ç’°å¢ƒã§å…±æœ‰ã—ãŸã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å®šç¾©ã—ã¾ã™
# ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã€ã‚³ãƒ”ãƒ¼ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‡¦ç†ã‹ã‚‰é¸æŠå¯èƒ½

# ä¾‹1: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã§å…±æœ‰
[[files]]
source = ".claude/config.template.json"  # ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«
target = ".claude/config.json"           # ãƒ¯ãƒ¼ã‚¯ãƒ„ãƒªãƒ¼å†…ã®é…ç½®å…ˆ
mapping_type = "symlink"                 # ãƒªãƒ³ã‚¯æ–¹å¼ï¼ˆsymlink/copy/templateï¼‰
skip_if_exists = true                    # æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
description = "Claude AIè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«"

# ä¾‹2: ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ï¼ˆå„ç’°å¢ƒã§å€‹åˆ¥ã«ç·¨é›†å¯èƒ½ï¼‰
[[files]]
source = ".env.template"
target = ".env"
mapping_type = "copy"                    # ã‚³ãƒ”ãƒ¼ã—ã¦é…ç½®
skip_if_exists = true                    # æ—¢å­˜ã®.envã¯ä¸Šæ›¸ãã—ãªã„
description = "ç’°å¢ƒå¤‰æ•°è¨­å®š"

# ä¾‹3: VSCodeè¨­å®šã‚’å…±æœ‰
[[files]]
source = ".vscode/settings.template.json"
target = ".vscode/settings.json"
mapping_type = "symlink"
skip_if_exists = false                   # å¸¸ã«ä¸Šæ›¸ã
description = "VSCodeè¨­å®š"

# ä¾‹4: Gitãƒ•ãƒƒã‚¯ã‚’å…±æœ‰
[[files]]
source = "shared/hooks"
target = ".git/hooks"
mapping_type = "symlink"
skip_if_exists = false
description = "å…±æœ‰Gitãƒ•ãƒƒã‚¯"

# ä¾‹5: npmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸è¨­å®š
[[files]]
source = "package.json"
target = "package.json"
mapping_type = "symlink"
skip_if_exists = false
description = "npmä¾å­˜é–¢ä¿‚"

# ä¾‹6: Dockerè¨­å®š
[[files]]
source = "docker-compose.template.yml"
target = "docker-compose.yml"
mapping_type = "copy"
skip_if_exists = true
description = "Docker Composeè¨­å®š"

# ====================
# ãƒ•ãƒƒã‚¯è¨­å®š
# ====================
# ç’°å¢ƒã®ä½œæˆãƒ»å‰Šé™¤æ™‚ã«å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚’å®šç¾©
# {name} ã¯ç’°å¢ƒåï¼ˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåï¼‰ã«ç½®æ›ã•ã‚Œã¾ã™

[hooks]

# ç’°å¢ƒä½œæˆå‰ã«å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰
pre_create = [
    # ãƒ­ã‚°å‡ºåŠ›
    { 
        command = "echo 'ğŸš€ Creating environment: {name}'", 
        continue_on_error = false 
    },
    
    # ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã‚‚ç¶šè¡Œï¼‰
    { 
        command = "npm install", 
        continue_on_error = true,
        timeout = 300  # 5åˆ†ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
    },
    
    # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
    { 
        command = "mkdir -p ./worktrees/{name}/.cache", 
        continue_on_error = true 
    }
]

# ç’°å¢ƒä½œæˆå¾Œã«å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰
post_create = [
    # æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    { 
        command = "echo 'âœ… Environment {name} created successfully'", 
        continue_on_error = false 
    },
    
    # VS Codeã§é–‹ãï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    { 
        command = "code ./worktrees/{name}", 
        continue_on_error = true 
    },
    
    # åˆæœŸè¨­å®šã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œ
    { 
        command = "./scripts/setup-environment.sh {name}", 
        continue_on_error = true,
        timeout = 120
    },
    
    # Gitè¨­å®š
    { 
        command = "cd ./worktrees/{name} && git config user.email 'agent-{name}@example.com'", 
        continue_on_error = true 
    }
]

# ç’°å¢ƒå‰Šé™¤å‰ã«å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰
pre_remove = [
    # è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    { 
        command = "echo 'âš ï¸  Removing environment: {name}'", 
        continue_on_error = false 
    },
    
    # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    { 
        command = "tar -czf ./backups/{name}-$(date +%Y%m%d).tar.gz ./worktrees/{name}/.env ./worktrees/{name}/data", 
        continue_on_error = true 
    },
    
    # ãƒ—ãƒ­ã‚»ã‚¹ã®åœæ­¢
    { 
        command = "pkill -f 'worktrees/{name}'", 
        continue_on_error = true 
    }
]

# ç’°å¢ƒå‰Šé™¤å¾Œã«å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰
post_remove = [
    # å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    { 
        command = "echo 'ğŸ—‘ï¸  Environment {name} removed'", 
        continue_on_error = false 
    },
    
    # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
    { 
        command = "rm -rf /tmp/cache-{name}", 
        continue_on_error = true 
    }
]

# ====================
# é«˜åº¦ãªè¨­å®šä¾‹ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆï¼‰
# ====================

# ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‡¦ç†ã‚’ä½¿ç”¨ã—ãŸè¨­å®šï¼ˆæœªå®Ÿè£…ï¼‰
# [[files]]
# source = "config.template"
# target = "config.json"
# mapping_type = "template"
# variables = { 
#     api_key = "${API_KEY}",
#     environment = "{name}",
#     port = "3000"
# }

# æ¡ä»¶ä»˜ããƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆæœªå®Ÿè£…ï¼‰
# [[files]]
# source = "windows-config.json"
# target = ".config/app.json"
# mapping_type = "copy"
# condition = "os.platform == 'windows'"

# ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã•ã‚ŒãŸãƒ•ãƒƒã‚¯ï¼ˆæœªå®Ÿè£…ï¼‰
# [hooks.groups.database]
# pre_create = [
#     { command = "docker-compose up -d postgres", continue_on_error = false },
#     { command = "npm run db:migrate", continue_on_error = false }
# ]
#!/bin/sh
set -e

echo "ğŸš€ Running pre-commit checks..."
echo ""

# 1. ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯
echo "ğŸ“ Checking code formatting..."
if ! cargo fmt -- --check; then
    echo ""
    echo "âŒ Code is not properly formatted!"
    echo "ğŸ’¡ Run 'cargo fmt' to fix formatting issues"
    exit 1
fi
echo "âœ… Format check passed"
echo ""

# 2. Clippy (Linter)
echo "ğŸ” Running clippy linter..."
if ! cargo clippy --all-targets --all-features -- -D warnings; then
    echo ""
    echo "âŒ Clippy found issues!"
    echo "ğŸ’¡ Fix the warnings above before committing"
    exit 1
fi
echo "âœ… Clippy check passed"
echo ""

# 3. ãƒ“ãƒ«ãƒ‰ãƒã‚§ãƒƒã‚¯
echo "ğŸ”¨ Checking if project builds..."
if ! cargo check --all-targets; then
    echo ""
    echo "âŒ Build check failed!"
    exit 1
fi
echo "âœ… Build check passed"
echo ""

# 4. é«˜é€Ÿãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆå˜ä½“ãƒ†ã‚¹ãƒˆã®ã¿ï¼‰
echo "ğŸ§ª Running unit tests..."
if ! cargo test --lib --bins; then
    echo ""
    echo "âŒ Some tests failed!"
    exit 1
fi
echo "âœ… Unit tests passed"
echo ""

echo "âœ¨ All pre-commit checks passed successfully!"